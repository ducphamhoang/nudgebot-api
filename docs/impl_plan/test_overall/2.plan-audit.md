I have created the following plan after thorough exploration and analysis of the codebase. Follow the below plan verbatim. Trust the files and references. Do not re-verify what's written in the plan. Explore only when absolutely necessary. First implement all the proposed file changes and then I'll review all the changes together at the end.

### Observations

Based on my analysis of the codebase, I found that while the project has comprehensive test infrastructure, there are several issues preventing tests from running correctly:

**Primary Issue**: Missing generated mock files - all `go:generate mockgen` directives in `internal/mocks/interfaces.go` reference mock files that don't exist in the repository.

**Secondary Issues**: Potential flakiness from `time.Sleep` usage in async tests, hardcoded ports that could cause collisions, and duplicate database setup functions in integration tests.

**Positive Findings**: No compilation errors, all dependencies properly declared, comprehensive test coverage with both unit and integration tests, proper Docker/testcontainers setup.

### Approach

The approach will be systematic: first generate missing mocks, then run test commands to identify runtime failures, fix any issues found, and document the final test status. This follows the "fail fast, fix incrementally" principle.

I'll start with the critical blocking issue (missing mocks), then execute the actual test commands to surface real runtime problems, address those issues, and finally create comprehensive documentation of test status and any remaining issues.

### Reasoning

I analyzed the project structure and examined all test-related files including the Makefile, integration test files, unit test files, mock generation setup, and dependency configuration. I identified that while the codebase appears clean from a compilation perspective, there are missing generated mock files that could cause test failures. I also found potential runtime issues related to timing, port conflicts, and test infrastructure setup.

## Mermaid Diagram

sequenceDiagram
    participant Dev as Developer
    participant Script as Test Runner Script
    participant Make as Makefile Targets
    participant Docker as Docker/Testcontainers
    participant Tests as Test Suite
    participant Docs as Documentation

    Dev->>Script: Execute test-runner.sh
    Script->>Script: Validate Environment (Docker, Go, CGO)
    Script->>Make: Run go mod tidy & verify
    Script->>Make: Execute make generate-mocks
    Make->>Tests: Generate missing mock files
    Script->>Make: Run go vet & compilation check
    Script->>Make: Execute make test-unit
    Make->>Tests: Run unit tests with mocks
    Tests-->>Script: Unit test results
    Script->>Make: Execute make test-integration
    Make->>Docker: Start testcontainers (Postgres)
    Docker-->>Make: Container ready
    Make->>Tests: Run integration tests
    Tests->>Docker: Database operations & migrations
    Tests-->>Script: Integration test results
    Script->>Docs: Generate test_status.md
    Script->>Docs: Create execution log
    Script-->>Dev: Final test status report

## Proposed File Changes

### docs\test_status.md(NEW)

References: 

- Makefile
- internal\mocks\interfaces.go

Create comprehensive test status documentation that will be populated during the fix process. This file will document:

- **Compilation Issues Fixed**: List of packages and actions taken to resolve compilation problems
- **Test Execution Results**: Results from running `make test-unit` and `make test-integration`
- **Runtime Failures**: Table of any tests that fail during execution with root cause analysis
- **Environment Prerequisites**: Docker, CGO_ENABLED=1, and other requirements discovered
- **Mock Generation Status**: Status of generated vs custom mocks
- **Recommendations**: Suggested improvements for test reliability

The file will serve as a living document updated throughout the fix process and provide a final summary of test infrastructure health.

### internal\mocks(MODIFY)

References: 

- internal\mocks\interfaces.go
- Makefile

Generate all missing mock files by executing the mock generation process. The `internal/mocks/interfaces.go` file contains 8 `go:generate mockgen` directives that reference mock files that don't exist:

- `event_bus_mock.go`
- `chatbot_service_mock.go` 
- `telegram_provider_mock.go`
- `llm_service_mock.go`
- `llm_provider_mock.go`
- `nudge_service_mock.go`
- `nudge_repository_mock.go`
- `scheduler_mock.go`

Execute `make generate-mocks` (which runs `go generate ./internal/mocks/...`) to create these missing files. Verify that all generated mocks compile successfully and match their source interfaces. Check if any existing tests depend on these generated mocks versus the current custom mock implementations.

If generation fails, investigate and fix any interface mismatches or missing dependencies. Ensure the generated mocks are compatible with existing test code that may reference them.

### integration_test_helpers.go(MODIFY)

References: 

- integration\message_flow_test.go(MODIFY)

Address potential port collision issues and improve test reliability. The current implementation uses hardcoded port 8080 for mock API servers in the `TestAPIServer.Start()` method, which could cause conflicts during parallel test execution.

Modify the mock API server setup to use dynamic port allocation instead of hardcoded ports. Update the `TestAPIServer` struct to properly handle port assignment and ensure the `GetURL()` method returns the correct dynamically assigned port.

Also consolidate the database setup functionality with `integration/message_flow_test.go` to avoid code duplication. The `SetupTestDatabase` function in this file and the `setupTestDatabase` function in `integration/message_flow_test.go` serve similar purposes but have slight differences that could lead to inconsistent test behavior.

Create a unified database setup approach that both files can use, ensuring consistent testcontainer configuration, connection retry logic, and cleanup procedures.

### integration\message_flow_test.go(MODIFY)

References: 

- integration_test_helpers.go(MODIFY)

Consolidate database setup with the centralized approach from `integration_test_helpers.go` to eliminate code duplication. The current `setupTestDatabase` function (lines 38-97) duplicates functionality already available in the helpers file.

Replace the local `setupTestDatabase` function with a call to the centralized `SetupTestDatabase` function from `integration_test_helpers.go`. This will ensure consistent testcontainer configuration, connection retry logic, and cleanup procedures across all integration tests.

Update the test functions to use the `TestContainer` struct returned by the centralized setup function instead of the local database connection and cleanup function. This change will improve maintainability and reduce the risk of inconsistent test behavior due to different database setup approaches.

Verify that the event bus synchronous mode setting and other test-specific configurations are preserved during this consolidation.

### test_execution_results.log(NEW)

References: 

- Makefile

Create a detailed log file to capture the results of test execution during the fix process. This file will contain:

- **Mock Generation Results**: Output from `make generate-mocks` including any errors or warnings
- **Unit Test Results**: Complete output from `make test-unit` including pass/fail status for each test
- **Integration Test Results**: Complete output from `make test-integration` including container startup logs and test execution details
- **Compilation Check Results**: Output from `go vet ./...` and `go test -c ./...` to verify compilation status
- **Environment Verification**: Confirmation that Docker is running, CGO_ENABLED=1 is set, and other prerequisites are met

This log will serve as a detailed record of the fix process and help identify any remaining issues that need to be addressed. It will be referenced when creating the final test status documentation.

### scripts\test-runner.sh(NEW)

References: 

- Makefile
- docker-compose.test.yml

Create a comprehensive test runner script that automates the entire test execution and validation process. This script will:

1. **Environment Validation**: Check that Docker is running, Go version is compatible, and CGO_ENABLED=1 is set
2. **Dependency Verification**: Run `go mod tidy` and `go mod verify` to ensure dependencies are clean
3. **Mock Generation**: Execute `make generate-mocks` and verify all expected mock files are created
4. **Compilation Check**: Run `go vet ./...` and `go test -c ./...` to catch compilation issues early
5. **Unit Test Execution**: Run `make test-unit` with detailed output capture
6. **Integration Test Execution**: Run `make test-integration` with container logs and timing information
7. **Results Analysis**: Parse test outputs to identify failures and categorize them
8. **Cleanup**: Ensure test containers are properly stopped and cleaned up

The script will provide colored output for easy identification of issues and generate both console output and log files for detailed analysis. It will also set appropriate exit codes for CI/CD integration.